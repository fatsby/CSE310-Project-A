<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Assignment 2</title>
        <script
            src="https://code.jquery.com/jquery-3.7.1.js"
            integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
            crossorigin="anonymous"
        ></script>
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
            integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer"
        />
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT"
            crossorigin="anonymous"
        />
        <style>
            .left-side,
            .right-side {
                padding: 15px;
                box-sizing: border-box;
                border: 1px solid black;
            }
        </style>
    </head>
    <body>
        <div class="container-fluid">
            <div class="row">
                <div class="col-3">
                    <div class="left-side">
                        <h2>Class list</h2>
                        <ul id="left-class-list"></ul>
                    </div>
                </div>
                <div class="col-9">
                    <div class="right-side">
                        <div class="card">
                            <h5 class="card-header">
                                Edit student's information
                            </h5>
                            <div class="card-body">
                                <form action="">
                                    <div class="row mb-3">
                                        <div class="col-2">
                                            <div class="form-group">
                                                <input
                                                    type="text"
                                                    class="form-control"
                                                    placeholder="ID"
                                                    aria-label="Username"
                                                    aria-describedby="basic-addon1"
                                                    id="id-input"
                                                />
                                            </div>
                                        </div>
                                        <div class="col-3">
                                            <div class="form-group">
                                                <input
                                                    type="text"
                                                    class="form-control"
                                                    placeholder="Nguyen Van A"
                                                    aria-label="Username"
                                                    aria-describedby="basic-addon1"
                                                    id="name-input"
                                                />
                                            </div>
                                        </div>
                                        <div class="col-3">
                                            <div class="form-group">
                                                <input
                                                    type="email"
                                                    class="form-control"
                                                    id="email-input"
                                                    placeholder="a@student.com"
                                                    aria-describedby="emailHelp"
                                                />
                                            </div>
                                        </div>
                                        <div class="col-2">
                                            <div class="form-group">
                                                <select
                                                    class="form-select"
                                                    aria-label="Default select example"
                                                    id="classItem"
                                                ></select>
                                            </div>
                                        </div>
                                        <div class="col-2">
                                            <div class="form-group">
                                                <button
                                                    data-id="0"
                                                    type="button"
                                                    class="btn btn-primary"
                                                    id="add"
                                                >
                                                    Add
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <div
                                        class="row justify-content-center align-items-center"
                                    >
                                        <div class="col-4">
                                            <div class="input-group mb-3">
                                                <input
                                                    type="text"
                                                    class="form-control"
                                                    placeholder="Student name"
                                                    aria-label="Recipientâ€™s username"
                                                    aria-describedby="button-addon2"
                                                    id="search-name"
                                                />
                                                <button
                                                    class="btn btn-outline-secondary"
                                                    type="button"
                                                    id="search-btn"
                                                >
                                                    Search
                                                </button>
                                            </div>
                                            <div class="input-group mb-3">
                                                <select
                                                    class="form-select"
                                                    aria-label="Default select example"
                                                    id="classFilter"
                                                ></select>
                                                <button
                                                    class="btn btn-outline-secondary"
                                                    type="button"
                                                    id="filter-btn"
                                                >
                                                    Filter
                                                </button>
                                            </div>
                                        </div>
                                        <div class="col-2">
                                            <button
                                                class="btn btn-outline-secondary"
                                                type="button"
                                                id="reset-btn"
                                            >
                                                Reset
                                            </button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <div class="card mt-5">
                            <div class="card-header">Student List</div>
                            <div class="card-body">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th scope="col">#</th>
                                            <th scope="col">Fullname</th>
                                            <th scope="col">Student ID</th>
                                            <th scope="col">Email</th>
                                            <th scope="col">Class</th>
                                            <th scope="col">Handle</th>
                                        </tr>
                                    </thead>
                                    <tbody id="table-body"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO"
            crossorigin="anonymous"
        ></script>

        <script>
            $().ready(function () {
                let studentList;
                let classData;
                $.get(
                    "http://139.180.213.49/getdata-student.php",
                    {
                        Type: "Student",
                    },
                    function (data) {
                        console.log(data);
                        studentList = data;
                        showList(studentList);
                    },
                    "json"
                );

                $.get(
                    "http://139.180.213.49/getdata-student.php",
                    {
                        Type: "Class",
                    },
                    function (data) {
                        console.log(data);
                        classData = data;
                        classPick(classData);
                    },
                    "json"
                );

                function classPick(list) {
                    for (let item of list) {
                        $("#classItem").append(`<option value="${item}">
                                                        ${item}
                                                    </option>`);
                        $("#classFilter").append(`<option value="${item}">
                                                        ${item}
                                                    </option>`);

                        $("#left-class-list").append(`<li>${item}</li>`);
                    }
                }

                function showList(list) {
                    $("#table-body").empty();
                    let i = 1;
                    for (let item of list) {
                        $("#table-body").append(`<tr>
                                            <th scope="row">${i}</th>
                                            <td>${item.Name}</td>
                                            <td>${item.ID}</td>
                                            <td>${item.Email}</td>
                                            <td>${item.Class}</td>
                                            <td>
                                                <button
                                                    type="button"
                                                    class="btn btn-secondary me-3 edit-btn"
                                                    data-id="${item.ID}"
                                                >
                                                    Edit</button
                                                ><button
                                                    type="button"
                                                    class="btn btn-danger delete-btn"
                                                    data-id="${item.ID}"
                                                >
                                                    Delete
                                                </button>
                                            </td>
                                        </tr>)`);
                        i++;
                    }
                }

                $("#filter-btn").click(function () {
                    const filterList = [];
                    const classTarget = $("#classFilter").val();
                    for (const item of studentList) {
                        if (item.Class === classTarget) {
                            filterList.push(item);
                        }
                        showList(filterList);
                    }
                });

                $("#reset-btn").click(function () {
                    showList(studentList);
                });

                $("#add").click(function () {
                    let id = $("#id-input").val();
                    let name = $("#name-input").val();
                    let email = $("#email-input").val();

                    let classItem = $("#classItem").val();

                    let idFlag = $(this).attr("data-id");

                    if (idFlag == 0) {
                        let newStudent = {
                            Class: classItem,
                            Email: email,
                            ID: id,
                            Name: name,
                        };

                        studentList.unshift(newStudent);
                    } else {
                        for (let item of studentList) {
                            if (item.ID == idFlag) {
                                item.ID = id;
                                item.Name = name;
                                item.Email = email;
                                item.Class = name;
                                break;
                            }
                        }
                    }

                    showList(studentList);

                    $("#id-input").val("");
                    $("#name-input").val("");
                    $("#email-input").val("");

                    $("#add").html("Add");
                    $("#add").attr("data-id", 0);
                });

                $("#table-body").on("click", ".edit-btn", function () {
                    const id = $(this).attr("data-id");
                    for (const student of studentList) {
                        if (student.ID == id) {
                            $("#id-input").val(student.ID);
                            $("#name-input").val(student.Name);
                            $("#email-input").val(student.Email);
                            $("#classItem").val(student.Class);

                            $("#add").html("Edit");
                            $("#add").attr("data-id", id);
                            break;
                        }
                    }
                });

                $("#table-body").on("click", ".delete-btn", function () {
                    const id = $(this).attr("data-id");
                    let index = -1;
                    if (confirm("Do you want to delete this student?")) {
                        for (let i = 0; i < studentList.length; i++) {
                            if (studentList[i].ID == id) {
                                index = i;
                                break;
                            }
                        }

                        if (index != -1) {
                            studentList.splice(index, 1);
                        }

                        showList(studentList);
                    }
                });

                $("#search-btn").on("click", function () {
                    const name = $("#search-name").val();
                    const listOutput = [];
                    for (const student of studentList) {
                        if (student.Name.toLowerCase().includes(name)) {
                            listOutput.push(student);
                        }
                    }
                    showList(listOutput);
                });
            });
        </script>
    </body>
</html>
